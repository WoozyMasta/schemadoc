# schemadoc

Markdown documentation generator for JSON Schema.
It is available as both a CLI tool and a Go package.

It can:

* render markdown from schema files or stdin
* reflect Go types to JSON Schema
* generate markdown directly from Go types in one step
* export and use built-in templates or custom templates

## CLI

The CLI is for quick schema docs generation and for
module-to-schema/module-to-markdown workflows.  
Use `-h` or `--help` on the root command
and subcommands for exact flags and arguments.

### `schema2md`

Convert JSON Schema to markdown.  
Reads schema from file argument or stdin;
writes markdown to file argument or stdout.

```shell
schemadoc schema2md schema.json > schema.md
cat schema.json | schemadoc schema2md -t table > schema.table.md
```

### `mod2schema`

Reflect Go type into JSON Schema.  
Use module import path as positional argument.
Use `--module-root` for local module directory
and `--package` when type is not in module root package.

> [!NOTE]  
> Requires installed Go toolchain (`go` in `PATH`).

```shell
schemadoc mod2schema --module-root . --type Config github.com/acme/project > schema.json
schemadoc mod2schema --module-root . --package github.com/acme/project/internal/config --type Config github.com/acme/project schema.json
```

### `mod2md`

Generate markdown directly from Go type.  
This is `mod2schema` + `schema2md` in one command.
Same module/package/type selection rules as `mod2schema`.

> [!NOTE]  
> Requires installed Go toolchain (`go` in `PATH`).

```shell
schemadoc mod2md --module-root . --type Config github.com/acme/project > model.md
schemadoc mod2md -t table --module-root . --type Config github.com/acme/project docs/model.table.md
```

### `template`

Print built-in markdown template text (`list` or `table`).  
Use it as a starting point for a custom template file.

```shell
schemadoc template > list.gotmpl
schemadoc template -t table templates/table.gotmpl
```

Generated example artifacts:

* [`examples/schema.json`](examples/schema.json)
* [`examples/schema.list.md`](examples/schema.list.md)
* [`examples/schema.table.md`](examples/schema.table.md)

Generate or refresh them:

```shell
make example
```

## Package

The package API is for embedding rendering in Go applications.

Key public API:

* `Render(schemaBytes []byte, opt Options) (string, error)`
* `RenderFile(path string, opt Options) (string, error)`
* `BuiltinTemplateNames() []string`
* `BuiltinTemplate(name string) (string, error)`
* `DetectDraft(schemaURI string) DraftInfo`

Examples:

Render markdown from schema bytes with built-in `list` template:

```go
schemaBytes, err := os.ReadFile("schema.json")
if err != nil {
    return err
}

md, err := schemadoc.Render(schemaBytes, schemadoc.Options{
    Title:        "Config Reference",
    TemplateName: "list",
    WrapWidth:    100,
    SourcePath:   "schema.json",
})
if err != nil {
    return err
}

fmt.Println(md)
```

Render markdown from file using built-in `table` template text:

```go
tpl, err := schemadoc.BuiltinTemplate("table")
if err != nil {
    return err
}

md, err := schemadoc.RenderFile("schema.json", schemadoc.Options{
    Title:        "Config Reference",
    TemplateText: tpl,
})
if err != nil {
    return err
}

fmt.Println(md)
```

Detect schema draft support:

```go
info := schemadoc.DetectDraft("https://json-schema.org/draft/2020-12/schema")
fmt.Printf("draft=%s supported=%v\n", info.Canonical, info.Supported)
```

## Schema Generation

Module reflection (`mod2schema` and `mod2md`) is based on
`github.com/invopop/jsonschema`.  
The CLI creates a temporary Go module for reflection
and installs this dependency there,
so target project `go.mod` and `go.sum` are not modified.
If your schema is generated by this package, `schemadoc` will work as expected.

Example Go model with `jsonschema` tags:

```go
type Config struct {
    Name     string `json:"name" jsonschema:"required,minLength=1,example=demo"`
    Template string `json:"template,omitempty" jsonschema:"default=list,enum=list,enum=table"`
    Wrap     int    `json:"wrap,omitempty" jsonschema:"default=80,minimum=1,example=100"`
}
```
